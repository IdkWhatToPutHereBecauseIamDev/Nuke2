<button id="nuke">NUKE</button>

<script>
const VIDEO_URL = "/Nuke2/video.mov";   // GitHub Pages path
const AUDIO_URL = "/Nuke2/audio.wav";   // GitHub Pages path

let nuking = false;
let firstWindowSpawned = false;

document.getElementById("nuke").onclick = () => {
    if (!nuking) {
        nuking = true;
        loopSpawn();
    }
};

function loopSpawn() {
    procreate();
    setTimeout(loopSpawn, 300);
}

function procreate() {
    const w = 400;
    const h = 300;

    // First window = audio, rest = video
    const urlToOpen = firstWindowSpawned ? VIDEO_URL : AUDIO_URL;
    firstWindowSpawned = true;

    const win = window.open(
        urlToOpen,
        "_blank",
        `width=${w},height=${h},left=100,top=100`
    );

    if (!win) return;

    let dx = (Math.random() * 8) + 4;
    let dy = (Math.random() * 8) + 4;

    playBall(win, w, h, dx, dy);

    const watcher = setInterval(() => {
        if (win.closed) {
            clearInterval(watcher);
            procreate();
        }
    }, 200);
}

function playBall(win, w, h, dx, dy) {
    const screenW = window.screen.availWidth;
    const screenH = window.screen.availHeight;

    function step() {
        if (win.closed) return;

        let x = win.screenX + dx;
        let y = win.screenY + dy;

        if (x <= 0 || x + w >= screenW) dx = -dx;
        if (y <= 0 || y + h >= screenH) dy = -dy;

        win.moveTo(x, y);

        requestAnimationFrame(step);
    }

    step();
}
</script>
